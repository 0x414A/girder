- hosts: girder
  tasks:

    # Add an initial user - this user will be admin
    - name: Create 'admin' User
      girder:
        port: 8080
        user:
          firstName: "Chris"
          lastName: "Kotfila"
          login: "admin"
          password: "letmein"
          email: "chris.kotfila@kitware.com"
          admin: yes
        state: present

    # Create a 'test' user
    - name: Create 'test' User
      girder:
        port: 8080
        username: "admin"
        password: "letmein"
        user:
          firstName: "Test"
          lastName: "Test"
          login: "test"
          password: "testtesttest"
          email: "test.test@kitware.com"
          admin: yes
        state: present

    - name: Create collection
      girder:
        port: 8080
        username: "admin"
        password: "letmein"
        collection:
          name: "Test Collection"
          description: "A test collection"
      register: test_collection

    - debug: msg="{{ test_collection['gc_return'] }}"

    - name: Create collection with same values (should not show changed)
      girder:
        port: 8080
        username: "admin"
        password: "letmein"
        collection:
          name: "Test Collection"
          description: "A test collection"
      register: test_collection

    - debug: msg="{{ test_collection['gc_return'] }}"

    - name: Change test collection description
      girder:
        port: 8080
        username: "admin"
        password: "letmein"
        collection:
          name: "Test Collection"
          description: "A test collection with a different description"
      register: test_collection

    - debug: msg="{{ test_collection['gc_return'] }}"

    - name: Change the test collection name by using 'id'
      girder:
        port: 8080
        username: "admin"
        password: "letmein"
        collection:
          id: "{{ test_collection['gc_return']['_id'] }}"
          name: "Test Collection (different name)"
          description: "A test collection"
      register: test_collection


    - debug: msg="{{ test_collection['gc_return'] }}"

    - name: Delete the test collection
      girder:
        port: 8080
        username: "admin"
        password: "letmein"
        collection:
          id: "{{ test_collection['gc_return']['_id'] }}"
          name: "Test Collection (different name)"
          description: "A test collection"
        state: absent
      register: test_collection


    - debug: msg="{{ test_collection['gc_return'] }}"
